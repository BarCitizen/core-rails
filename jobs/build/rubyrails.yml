---
- name: Make sure we have everything for ruby
  apt:
    pkg:
      - libssl-dev
      - libreadline-dev 
      - zlib1g-dev 
      - autoconf 
      - bison 
      - build-essential 
      - libyaml-dev 
      - libreadline-dev 
      - libncurses5-dev 
      - libffi-dev 
      - libgdbm-dev
    state: latest
- name: Drop setup script
  ansible.builtin.template:
    src: "{{ playbook_dir }}/templates/ruby-setup.j2"
    dest: "/usr/local/bin/ruby-setup"
    mode: "0555"
- name: Prepare to install Ruby
  ansible.builtin.shell:
    cmd: |
      /usr/local/bin/ruby-setup

- name: Install Ruby via RBENV
  ansible.builtin.shell:
    cmd: |
      rbenv install {{ rbenv.version}} 
      rbenv global {{ rbenv.version}}
      rbenv rehash

- name: Install Gems
  ansible.builtin.shell:
    cmd: |
      gem install bundler
      gem install rails -v {{ rails.version }}
