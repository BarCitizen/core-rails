---
- name: Install Ruby and Rails from package
  ansible.builtin.apt:
    pkg:
#      - ruby
#      - ruby-dev
#      - ruby-rails
      - autoconf
      - patch
      - build-essential
      - rustc
      - libssl-dev
      - libyaml-dev
      - libreadline6-dev
      - zlib1g-dev
      - libgmp-dev
      - libncurses5-dev
      - libffi-dev
      - libgdbm6
      - libgdbm-dev
      - libdb-dev
      - uuid-dev
- name: Get Ruby installer
  ansible.builtin.unarchive:
    src: "https://github.com/postmodern/ruby-install/archive/refs/tags/v{{ ruby.installer.version }}.tar.gz"
    dest: /usr/local
- name: Rename Folder
  ansible.builtin.command: "mv /usr/local/ruby-install-{{ ruby.installer.version }} /usr/local/ruby-install"
- name: Install Ruby
  ansible.builtin.shell:
    cmd: |
      ruby-install --system ruby {{ ruby.version}}

- name: Update Gems
  ansible.builtin.shell:
    cmd: |
      ruby -v
      gem update --system
- name: Install Bundler and rails
  community.general.gem:
    name: "{{ item }}"
    state: latest
  loop:
    - bundler
    - rails
  async: 60
  poll: 5
